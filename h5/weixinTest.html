<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,mininum-scale=1,maximum-scale=1,userscalable=no"/>
    <meta name="screen-orientation"content="portrait">
    <meta name="x5-orientation"content="portrait">
    <title></title>

    <link rel="stylesheet" href="css/weiXin/weui.min.css">
    <link rel="stylesheet" href="css/weiXin/jquery-weui.css">
    <style>
        button{
            height: 63px;
            width: 70%;
            margin: auto;
            display: block;
            margin-top: 20%;
        }
    </style>
</head>
<body>
    <button id="share">分享给朋友</button>
    <button id="chooseImage">图片</button>
</body>

<script>var IS_WX_LOADED=0;</script>
<script type="text/javascript" src="js/zepto.js"></script>
<script type="text/javascript" src="js/plugin/dropload.min.js"></script>
<script type="text/javascript" src="js/jquery/jquery-weui.min.js"></script>

<script type="text/javascript" src="js/public/jweixin-1.0.0.js"></script>
<!--<script type="text/javascript" src="js/public/WeixinApi.js"></script>-->
<script type="text/javascript" src="js/public/sha1.js"></script>
<script type="text/javascript" src="js/public/myWxApi.js"></script>

<script>
    var iWidth=document.documentElement.clientWidth;
    document.getElementsByTagName("html")[0].style.fontSize=iWidth+"px";
</script>
<script type="text/javascript">

    var jsapi_ticket = '';
    var nonceStr = '';
    var timestamp =  '';
    var urlStr = '';
    var signature = '';



    //获取当前页面的url
    var get_url = function () {
        urlStr = window.location.href;
    };


    //随机字符生成算法
    function randomString(len) {
        len = len || 32;
        var $chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        var maxPos = $chars.length;
        var pwd = '';
        for (var i = 0; i < len; i++) {
            pwd += $chars.charAt(Math.floor(Math.random() * maxPos));
        }
        return pwd;
    }




    $.get( port + '/card/weixin/token/get',function (result) {
        nonceStr = randomString(16);
        timestamp =  String( parseInt((new Date().getTime() / 1000)) );
        jsapi_ticket = JSON.parse(result).wxticket;
        var string1 = 'jsapi_ticket=' + jsapi_ticket + '&noncestr=' + nonceStr + '&timestamp=' + timestamp + '&url=' + window.location.href;
        signature = hex_sha1(string1);



        console.log(nonceStr);
        console.log(timestamp);
        console.log(jsapi_ticket);
        console.log(window.location.href);
        console.log(string1);
        console.log(signature);



        wx.config({
            debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
            appId: 'wx886a1d1acb7084a5', // 必填，公众号的唯一标识
            timestamp: timestamp,// 必填，生成签名的时间戳
            nonceStr: nonceStr, // 必填，生成签名的随机串
            signature: signature, // 必填，签名，见附录1
            jsApiList: [
                'checkJsApi',
                'onMenuShareTimeline',  // 分享到朋友圈
                'onMenuShareAppMessage', //分享给朋友
                'onMenuShareQQ',
                'onMenuShareWeibo',
                'chooseImage'   //选择图片
            ]
            // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
        });
        wx.ready(function () {
            document.querySelector('#share').onclick = function () {
                wx.onMenuShareAppMessage({
                    title: '31232131312312313213', // 分享标题
                    desc: '21fsdsfdsfsdfsff', // 分享描述
                    link: 'www.baidu.com', // 分享链接
                    imgUrl: '', // 分享图标
                    type: '', // 分享类型,music、video或link，不填默认为link
                    dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                    success: function () {
                        // 用户确认分享后执行的回调函数
                        alert(2222222222);
                    },
                    cancel: function () {
                        // 用户取消分享后执行的回调函数
                    }
                });
            };

            var images = {
                localId: [],
                serverId: []
            };
            document.querySelector('#chooseImage').onclick = function () {
                wx.chooseImage({
                    success: function (res) {
                        images.localId = res.localIds;
                        alert('已选择 ' + res.localIds.length + ' 张图片');
                    }
                });
            };

        });
    })
</script>
</html>