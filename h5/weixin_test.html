<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>微信JS-SDK Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
  <script src="http://res.wx.qq.com/open/js/jweixin-1.1.0.js"></script>
  <script src="js/zepto.js"></script>
</head>

<body>
	<button id="share">微信分享测试按钮</button>
	<script>
		function loadwx(callback) {
		    // if (!IS_WX_LOADED){
		     if(true){
		        $.ajax({
		           type:"GET",
		          //url:"http://121.196.232.233:9292/card/weixin/signature?url=" + encodeURIComponent(location.href.split('#')[0]),
		          //url:"http://dev.jatyl.com/api/v0/weixin/signature?url=000",
		           url:port+"/card/weixin/signature?url=000",
		           timeout:5000,
		           success:function(data){
		           	   console.log(data);
		               // var key = JSON.parse(data).data;
		               var key = data;
		               wx.config({
		                   debug     : false,
		                   appId     : "wxae4ded78513c20ca",
		                   timestamp : key.timestamp,
		                   nonceStr  : key.noncestr,
		                   signature : key.signature,
		                   jsApiList: ['onMenuShareTimeline','onMenuShareAppMessage','onMenuShareQQ','onMenuShareWeibo','onMenuShareQZone']
		               });

		               wx.error(function(res) {
		               		alert(res);
		                   // config信息验证失败会执行error函数，如签名过期导致验证失败，具体错误信息可以打开config的debug模式查看，也可以在返回的res参数中查看，对于SPA可以在这里更新签名。
		                   console.log(res);
		               });

		               wx.ready(function() {
		               	alert("加载完成");

	//微信部分   
var sharetit = "weixin分享测试";
var sharedesc = "分享的描述";
var shareurl = "http://test.winthen.com/bcard/weixin_test.html";
var shareimg = "http://card2016.oss-cn-hangzhou.aliyuncs.com/97979b2fbfe1d7d4f1f87d3d797864f5.png";
    wx.onMenuShareTimeline({
        title: sharetit, // 分享标题
        link: shareurl, // 分享链接
        imgUrl: shareimg, // 分享图标
        success: function () { 
            // 用户确认分享后执行的回调函数
            alert('分享到朋友圈成功');
        },
        cancel: function () { 
            // 用户取消分享后执行的回调函数
            alert('取消分享到朋友圈成功');
        }
    });
    wx.onMenuShareAppMessage({
        title: sharetit, // 分享标题
        desc: "", // 分享描述
        link: shareurl, // 分享链接
        imgUrl: shareimg, // 分享图标
        type: 'link', // 分享类型,music、video或link，不填默认为link
        dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
        success: function () { 
            // 用户确认分享后执行的回调函数
            alert('分享给朋友成功');
        },
        cancel: function () { 
            // 用户取消分享后执行的回调函数
            alert('取消分享给朋友成功');
        }
    });
    wx.onMenuShareQQ({
        title: sharetit, // 分享标题
        desc: sharedesc, // 分享描述
        link: shareurl, // 分享链接
        imgUrl: shareimg, // 分享图标
        success: function () { 
            // 用户确认分享后执行的回调函数
            alert('分享到QQ成功');
        },
        cancel: function () { 
            // 用户取消分享后执行的回调函数
            alert('取消分享到QQ成功');
        }
    });
    wx.onMenuShareWeibo({
        title: sharetit, // 分享标题
        desc: sharedesc, // 分享描述
        link: shareurl, // 分享链接
        imgUrl: shareimg, // 分享图标
        success: function () { 
            // 用户确认分享后执行的回调函数
            alert('分享到腾讯微博成功');
        },
        cancel: function () { 
            // 用户取消分享后执行的回调函数
            alert('取消分享到腾讯微博成功');
        }
    });
    wx.onMenuShareQZone({
        title: sharetit, // 分享标题
        desc: sharedesc, // 分享描述
        link: shareurl, // 分享链接
        imgUrl: shareimg, // 分享图标
        success: function () { 
            // 用户确认分享后执行的回调函数
            alert('分享到QQ空间成功');
        },
        cancel: function () { 
            // 用户取消分享后执行的回调函数
            alert('取消分享到QQ空间成功');
        }
    });




		                   IS_WX_LOADED = 1;
		                   //wx.hideOptionMenu();
		                   //wx.hideAllNonBaseMenuItem();
		                   callback(wx);
		               });
		           },
		            error:function(status,statusText){
		                alert('获取数据错误！错误代号：' + status + '，错误信息：' + statusText);
		            }
		        });
		    }else{
		        callback(wx);
		    }
		}

    loadwx(function(wx){
    	alert(wx);
    	alert('获取微信接口成功');
    });
	</script>
</body>

</html>