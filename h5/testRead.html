<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- <meta name="screen-orientation"content="portrait"> -->
	<!-- <meta name="x5-orientation"content="portrait"> -->
    <!-- <meta name="viewport" content="width=device-width,initial-scale=1"/> -->
    <title>白金阅读ceshi</title>
    <!-- <link rel="stylesheet" href="css/reset.css"> -->
    <link rel="stylesheet" href="css/read.css">
    <script src="js/zepto.js"></script>
    <!-- <meta http-equiv="refresh" content="10; url=http://www.doyoe.com" /> -->
    <!--<script src="js/read.js"></script>-->
    <script>
    </script>
    <style type="text/css"></style>
</head>
<body>



<div>
<img src='imgs/iconfont-shijian.png'/style='width:10px;height:10px;'/>
<span style='color:#8a8a8a'>sdfsdfdsfsd</span>
<img src='imgs/iconfont-location.png'style='width:10px;height:10px;'/>
<span style='color:#8a8a8a'>sdfsdfdsfds</span>
</div>

<iframe   width="300" height="500" id="iframeId">
    
</iframe>
<style>
    .pageList_q{
        /*height: 30px;*/
        /*width: 200px;*/
        /*border: 1px solid #ccc;*/
    }
    .pageList_q ul{

    }
    .pageList_q ul li{
        display: inline-block;
        border: 1px solid #ccc;
        width:30px;
        height: 30px;
        text-align: center;
        line-height: 30px;
        cursor: pointer;

    }
    .pageList_q ul li:hover{
        /*border:1px solid #999;*/
        background-color: #bbb;
    }
    .pageList_q ul li:first-child,.pageList_q ul li:last-child{
        width: 60px;
    }
    .pageList_q .pre{
        /*border:1px solid #999;*/
        background-color: #bbb;
    }
</style>


<!-- <div class="pageList_q">
    <ul>
        <li class="prePage">上一页</li>
        <li>...</li>
        <li class = "pre">1</li>
        <li class = "current"></li>
        <li class = "next"></li>
        <li>...</li>
        <li class="nextPage">下一页</li>
    </ul>
</div> -->
<!-- <a href="js/read.js" download="lottory">下载</a> -->
<script>

    //请求函数，请求的参数，当前选中的页面
var currentValue_q = Number($(".pre").text());

    console.log(currentValue_q)

    function getPage(){      

        $(".prePage").click(function(){
            if(currentValue_q > 2){
                currentValue_q--;
                alert(currentValue_q);
                console.log(currentValue_q);
                // if(currentValue_q >= 2){
                    $(".pre").text(currentValue_q-1);
                    $(".current").text(currentValue_q);
                    $(".next").text(currentValue_q+1);
                // }

                $(".pageList_q .pre").css("background-color","#fff");
                $(".pageList_q .current").css("background-color","#bbb");                
            }else if(currentValue_q ==1){

                alert(currentValue_q);
                $(".pageList_q .pre").css("background-color","#bbb");
                $(".pageList_q .current").css("background-color","#fff");
            }else if(currentValue_q ==2){
                currentValue_q--;
                alert(currentValue_q)
                $(".pageList_q .pre").css("background-color","#bbb");
                $(".pageList_q .current").css("background-color","#fff");
            }
        });

        $(".nextPage").click(function(){
             if(currentValue_q > 1){

                currentValue_q++;
                alert(currentValue_q);
                // if(currentValue_q != 3){
                    $(".pre").text(currentValue_q-1);                
                    $(".current").text(currentValue_q);
                    $(".next").text(currentValue_q+1);  
                // }

                $(".pageList_q .pre").css("background-color","#fff");
                $(".pageList_q .current").css("background-color","#bbb");
           
            }else{
                
                $(".pageList_q .pre").css("background-color","#fff");
                $(".pageList_q .current").css("background-color","#bbb");
                
                currentValue_q++;
                alert(currentValue_q);
            }

        });

        // $(".pre, .current, .next").click(function(){
        //     //currentValue_q = $(this).text();
        //     alert(currentValue_q);
        //     alert($(this).text());
        //     // $(this).css("background-color","#bbb");
        //     currentValue_q = $(this).text();
        // });

console.log($("#iframeId").find("div"));

        $(".current").text(currentValue_q+1);
        $(".next").text(currentValue_q+2);



        console.log(currentValue_q);
        return currentValue_q;
    }
    getPage();
</script>

<!-- 
 var sss = window.top.document.getElementById("iframeId").contentWindow;

console.log(sss.location.href); -->
<script type="text/javascript">
      // alert(aaa);
//       Fn();  //浏览器报错:"undefined"
// console.log(+new Date()/1000);
// setTimeout(console.log(+new Date()/1000),1000);
// for(var i=1,len=1000;i<len;i++){
//     console.log(i*(i+1)*(i+2));
// }


</script>


<script type="text/javascript">
var tmp=$('<div class="resizer">'+
          '<div class="inner">'+
          '<img>'+
          '<div class="frames"></div>'+
          '</div>'+
          //'<button>&#10007;</button>'+
          '<button class="ok">&#10003;</button>'+
          '</div>');
$.imageResizer=function(){
    if(Uint8Array&&HTMLCanvasElement&&atob&&Blob){
        
    }else{
        return false;
    }
    var resizer=tmp.clone();
    
    resizer.image=resizer.find('img')[0];
    resizer.frames=resizer.find('.frames');
    resizer.okButton=resizer.find('button.ok');
    resizer.frames.offset={
        top:0,
        left:0
    };
    
    resizer.okButton.click(function(){
        resizer.clipImage();
    });
    resizer.clipImage=function(){
        var nh=this.image.naturalHeight,
            nw=this.image.naturalWidth,
            size=nw>nh?nh:nw;
        
        size=size>1000?1000:size;
        
        var canvas=$('<canvas width="'+size+'" height="'+size+'"></canvas>')[0],
            ctx=canvas.getContext('2d'),
            scale=nw/this.offset.width,
            x=this.frames.offset.left*scale,
            y=this.frames.offset.top*scale,
            w=this.frames.offset.size*scale*0.5,
            h=this.frames.offset.size*scale;
        
        ctx.drawImage(this.image,x,y,w,h,0,0,size,size);
        var src=canvas.toDataURL();
        this.canvas=canvas;
        this.append(canvas);
        this.addClass('uploading');
        this.removeClass('have-img');
        
        src=src.split(',')[1];
        if(!src)return this.doneCallback(null);
        src=window.atob(src);
        
        var ia = new Uint8Array(src.length);
        for (var i = 0; i < src.length; i++) {
            ia[i] = src.charCodeAt(i);
        };
        
        this.doneCallback(new Blob([ia], {type:"image/png"}));
    };
    
    resizer.resize=function(file,done){
        this.reset();
        this.doneCallback=done;
        this.setFrameSize(0);
        this.frames.css({
            top:0,
            left:0
        });
        var reader=new FileReader();
        reader.onload=function(){
            resizer.image.src=reader.result;
            reader=null;
            resizer.addClass('have-img');
            resizer.setFrames();
        };
        reader.readAsDataURL(file);
    };
    
    resizer.reset=function(){
        this.image.src='';
        this.removeClass('have-img');
        this.removeClass('uploading');
        this.find('canvas').detach();
    };
    
    resizer.setFrameSize=function(size){
        this.frames.offset.size=size;
        return this.frames.css({
            width:size+'px',
            height:size+'px'
        });
    };
    
    resizer.getDefaultSize=function(){
        var width=this.find(".inner").width(),
            height=this.find(".inner").height();
        this.offset={
            width:width,
            height:height
        };
        console.log(this.offset)
        return width>height?height:width;
    };
    
    resizer.moveFrames=function(offset){
        var x=offset.x,
            y=offset.y,
            top=this.frames.offset.top,
            left=this.frames.offset.left,
            size=this.frames.offset.size,
            width=this.offset.width,
            height=this.offset.height;
        
        if(x+size+left>width){
            x=width-size;
        }else{
            x=x+left;
        };
        
        if(y+size+top>height){
            y=height-size;
        }else{
            y=y+top;
        };
        x=x<0?0:x;
        y=y<0?0:y;
        this.frames.css({
            top:y+'px',
            left:x+'px'
        });
        
        this.frames.offset.top=y;
        this.frames.offset.left=x;
    };
    (function(){
        var time;
        function setFrames(){
            var size=resizer.getDefaultSize();
            resizer.setFrameSize(size);
        };
        
        window.onresize=function(){
            clearTimeout(time)
            time=setTimeout(function(){
                setFrames();
            },1000);
        };
        
        resizer.setFrames=setFrames;
    })();
    
    (function(){
        var lastPoint=null;
        function getOffset(event){
            event=event.originalEvent;
            var x,y;
            if(event.touches){
                var touch=event.touches[0];
                x=touch.clientX;
                y=touch.clientY;
            }else{
                x=event.clientX;
                y=event.clientY;
            }
            
            if(!lastPoint){
                lastPoint={
                    x:x,
                    y:y
                };
            };
            
            var offset={
                x:x-lastPoint.x,
                y:y-lastPoint.y
            }
            lastPoint={
                x:x,
                y:y
            };
            return offset;
        };
        resizer.frames.on('touchstart mousedown',function(event){
            getOffset(event);
        });
        resizer.frames.on('touchmove mousemove',function(event){
            if(!lastPoint)return;
            var offset=getOffset(event);
            resizer.moveFrames(offset);
        });
        resizer.frames.on('touchend mouseup',function(event){
            lastPoint=null;
        });
    })();
    return resizer;
};
var resizer=$.imageResizer(),
    resizedImage;

if(!resizer){
    resizer=$("<p>Your browser doesn't support these feature:</p><ul><li>canvas</li><li>Blob</li><li>Uint8Array</li><li>FormData</li><li>atob</li></ul>")   
};

$('.container').append(resizer);

$('input').change(function(event){
    var file=this.files[0];
    resizer.resize(file,function(file){
        resizedImage=file;
    });
});

$('button.submit').click(function(){
    var url=$('input.url').val();
    if(!url||!resizedFile)return;
    var fd=new FormData();
    fd.append('file',resizedFile);
    $.ajax({
        type:'POST',
        url:url,
        data:fd
    });
});
</script>


<input type="file" accept="images/*">
<input class="url" type="url" placeholder="url">
<div class="container"></div>
<button class="submit">Submit</button>


<style type="text/css">
    .container{
    width: 300px;
}
.resizer{
    overflow: hidden;
}
.resizer.have-img button.ok{
    display: inline-block;
}
.resizer.have-img .inner {
    display: block;
}
.inner{
    width: 100%;
    position: relative;
    font-size: 0;
    overflow: hidden;
    display: none;
}
img{
    width: 100%;
}

.frames{
    position: absolute;
    top: 0;
    left: 0;
    border: 1px solid black;
    cursor: move;
    outline: rgba(0, 0, 0, 0.6) solid 10000px;
}
button.ok{
    float:right;
    margin-left: 5px;
    display: none;
}
canvas{
    max-width: 100%;
    margin:auto;
    display: block;
}

</style>


<!-- 使用canvas上传图 -->
    <canvas id="canvas" style="display:block;margin:0 auto;border:1px solid #aaa;">
        您的浏览器尚不支持canvas
    </canvas>
    <input type="range" id="scale-range" min="0.5" max="3.0" step="0.01" value="1.0" style="display:block;margin:20px auto;width:800px"/>

    <canvas id="watermark-canvas" style="display:none;margin:0 auto;border:1px solid #aaa;">
        您的浏览器尚不支持canvas
    </canvas>
    <input type="file" id="setPic" onchange="readFile(this)"/> 
    <img id = "base64" src="" width="300px" height="300px" />
    <script>

    function readFile(obj){
        console.log(obj.files[0].size);
        var imgBase64 ;
        //这里用来限制图片的大小
        if(obj.files[0].size<80*1024){
            var file = obj.files[0];      
            //判断类型是不是图片  
            if(!/image\/\w+/.test(file.type)){
                alert("请确保文件为图像类型");   
                return false;   
            }   
            var reader = new FileReader();            
            reader.readAsDataURL(file);   
            reader.onload = function(e){
                console.log(this.result)
                imgBase64 = this.result;
                document.getElementById("base64").setAttribute("src",imgBase64);
                var self = this;                 
                $.ajax({
                    type:"POST",
                    contentType: "application/json",
                    url:port+"/card/file/base64.method?fileName="+Math.floor(Math.random()*10000)+".png",
                    data:JSON.stringify(this.result),

                    success:function(data){
                        console.log(data);
                        // document.querySelector(".headPic").src = data.url;
                    }
                });
            }   
        }else{
            alert("上传图片不要大于80kb！");
        }

        return imgBase64;
    }

















        var canvas = document.getElementById("canvas");
        var context = canvas.getContext("2d");
        var image = new Image();
        var slider = document.getElementById("scale-range");


        var watermarkCanvas = document.getElementById("watermark-canvas")
        var watermarkContext = watermarkCanvas.getContext("2d")
        window.onload = function(){
            canvas.width = 1152;
            canvas.height = 768;
            image.src = "images/personal.png";


            var scale = slider.value
            image.onload = function(){
                // context.drawImage(image,0,0);
                // context.drawImage(image,0,0,canvas.width,canvas.height);
                // context.drawImage(image,60,20,400,400,200,200,400,400);
                // context.drawImage(image,60,20,400,400,0,0,canvas.width,canvas.height);
                // 
                // 
                drawImageByScale(scale)

//                slider.onchange = function(){
//                    scale = slider.value
//                    drawImage( image , scale )
//                }

                slider.onmousemove = function(){
                    scale = slider.value
                    drawImageByScale( scale )
            }
        }
            //setup watermark canvas
            watermarkCanvas.width = 600
            watermarkCanvas.height = 100

            watermarkContext.font = "bold 50px Arial"
            watermarkContext.lineWidth = "1"
            watermarkContext.fillStyle = "rgba( 255 , 255 , 255 , 0.5 )"
            watermarkContext.textBaseline = "middle";
            watermarkContext.fillText( "== liuyubobobo.com ==" , 20 , 50 )
}


            function drawImageByScale( scale ){
            context.clearRect( 0 , 0 , canvas.width , canvas.height )
            var imageWidth = 1152 * scale
            var imageHeight = 768 * scale

            // var sx = imageWidth / 2 - canvas.width / 2
            // var sy = imageHeight / 2 - canvas.height / 2

            // context.drawImage( image , sx , sy , canvas.width , canvas.height , 0 , 0 , canvas.width , canvas.height )
            x = canvas.width /2 - imageWidth / 2
            y = canvas.height / 2 - imageHeight / 2
            // //先要清空画布，然后再进行图片的渲染
            context.drawImage( image , x , y , imageWidth , imageHeight )

                        context.drawImage( watermarkCanvas , canvas.width - watermarkCanvas.width ,
                                                  canvas.height - watermarkCanvas.height )
        }
    </script>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
&nbsp;<head>
&nbsp; <title> 通过js保存图片到本地 </title>
&nbsp; <meta name="Generator" content="EditPlus">
&nbsp; <meta name="Author" content="">
&nbsp; <meta name="Keywords" content="">
&nbsp; <meta name="Description" content="">
&nbsp; <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
</head>


&nbsp;<body>
&nbsp; <input type="button" value="download image" onclick="DownLoadReportIMG('http://www.oursss.com/uploads/photo/1045_2590.jpg?rd=0.9961522558898981');"> &nbsp;
&nbsp;</body>
</html></span></span>

<script>
    function DownLoadReportIMG(imgPathURL) {  
           
        //如果隐藏IFRAME不存在，则添加  
        if (!document.getElementById("IframeReportImg"))  
            $('<iframe style="display:none;" id="IframeReportImg" name="IframeReportImg" onload="DoSaveAsIMG();" width="0" height="0" src="about:blank"></iframe>').appendTo("body");  
        if (document.all.IframeReportImg.src != imgPathURL) {  
            //加载图片  
            document.all.IframeReportImg.src = imgPathURL;  
        }  
        else {  
            //图片直接另存为  
            DoSaveAsIMG();    
        }  
    }  
    function DoSaveAsIMG() {  
        if (document.all.IframeReportImg.src != "about:blank")  
            document.frames("IframeReportImg").document.execCommand("SaveAs");          
    }  

</script>


</body>
</html>